# 中間言語仕様書

このドキュメントは、構造化ラベル・スタックベースの中間言語の仕様を定義する。

---

## 🧱 基本構造

- 全命令は逐次実行される。
- `label:` によってブロックを定義する。
- 各ブロック（関数やwhileなど）は `STORE return` によって終了し、呼び出し元に制御が戻る。
- スタックは以下の2種類を用いる：

| 種類             | 用途                     |
|------------------|--------------------------|
| グローバルスタック | 値の計算・条件判定・一時保存 |
| ローカルスタック   | 各ラベル/関数内の変数保持     |

---

## 🧮 命令一覧

| 命令         | 説明 |
|--------------|------|
| `PUSH <val>` | 定数をグローバルスタックに積む |
| `LOAD <var>` | 変数の値をグローバルスタックに積む |
| `STORE <var>` | スタックのトップを変数に代入する |
| `STORE return` | 現在のブロック（:label:）から呼び出し元に戻る |
| `ADD` / `SUB` / `MUL` / `DIV` | スタックトップ2つを使って演算 |
| `GT` / `LT` / `EQ` | 比較演算：結果は0（偽）または1（真） |
| `DUP` | スタックトップを複製する |
| `MUL -1` | 真偽値を反転（疑似`NOT`） |
| `JMPIF <label>` | スタックトップが1ならジャンプ |
| `JMP <label>` | 無条件ジャンプ |